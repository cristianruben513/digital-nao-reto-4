---
import HtmlLayout from "../layout/HtmlLayout.astro"
import ProjectLayout from "../layout/ProjectLayout.astro"
---

<HtmlLayout>
  <ProjectLayout>
    <h1 class='text-xl md:text-3xl font-bold mb-10'>Scroll Infinito - API jsonplaceholder</h1>

    <div class='container mx-auto'>
      <div id='post-container' class='grid grid-cols-1 gap-4'></div>
      <p id='loading-text' class='text-center my-4 text-gray-500'>
        Cargando...
      </p>
    </div>
  </ProjectLayout>
</HtmlLayout>

<script>
  const postContainer = document.getElementById("post-container")
  const loadingText = document.getElementById("loading-text")

  let page = 1
  let loading = false

  async function getPosts() {
    loading = true
    loadingText.style.display = "block"

    const response = await fetch(
      `https://jsonplaceholder.typicode.com/posts?_page=${page}&_limit=10`,
    )
    const posts = await response.json()

    loadingText.style.display = "none"
    loading = false
    return posts
  }

  function renderPosts(posts) {
    posts.forEach((post) => {
      const postCard = document.createElement("div")
      postCard.classList.add("bg-white", "p-4", "rounded", "shadow", "text-sm", "border")
      postCard.innerHTML = `
            <h2 class="text-lg font-bold">${post.title}</h2>
            <p class="text-gray-600">${post.body}</p>
        `
      postContainer.appendChild(postCard)
    })
  }

  async function loadPosts() {
    if (loading) return
    const posts = await getPosts()
    renderPosts(posts)
    page++
  }

  // Cargar posts iniciales
  loadPosts()

  // Detectar scroll para cargar mÃ¡s posts
  window.addEventListener("scroll", () => {
    const { scrollTop, clientHeight, scrollHeight } = document.documentElement
    if (scrollTop + clientHeight >= scrollHeight - 5) {
      loadPosts()
    }
  })
</script>
